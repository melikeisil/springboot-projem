<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - Ownify</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="c.css">
</head>
<body>
    <!-- Top Bar -->
    <div class="top-bar">
        <div class="container">
            <div class="top-bar-content">
                <div class="welcome-text">Welcome to Ownify online marketplace platform.</div>
                <div class="follow-links">
                    <span>Follow us</span>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-facebook"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-circle">
                        <span class="logo-icon">O</span>
                    </div>
                    <span class="logo-text">Ownify</span>
                </div>

                <div class="search-container">
                    <input type="text" class="search-input" placeholder="Search for anything...">
                    <button class="search-btn">
                        <i class="fas fa-search"></i>
                    </button>
                </div>

                <div class="header-actions">
                    <div class="header-icons">
                        <a href="messaging.html" style="text-decoration: none; color: inherit;"> <i class="fas fa-comment-alt"></i> </a>                                                       
        <a href="wishlist.html" style="text-decoration: none; color: inherit;">
            <i class="fas fa-heart"></i>
        </a>                         
        <a href="dashboard.html" style="text-decoration: none; color: inherit;">
            <i class="fas fa-user-circle"></i>
        </a> 
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
<nav class="nav-section">
    <div class="header-bottom container">
        <div class="nav-menu">
            <div class="dropdown">
                <button class="dropdown-btn">
                    <i class="fas fa-bars"></i>
                    All Category
                    <i class="fas fa-chevron-down"></i>
                </button>
                <div class="dropdown-content">
                    <div class="category-item">
                        <a href="shop.html?category=computer-laptop" class="main-category">Computer & Laptop</a>
                    </div>
                    <div class="category-item">
                        <a href="shop.html?category=car" class="main-category">Car</a>
                    </div>
                    <div class="category-item">
                        <a href="shop.html?category=smartphone" class="main-category">SmartPhone</a>
                    </div>
                    <div class="category-item">
                        <a href="shop.html?category=tv-appliances" class="main-category">TV & Homes Appliances</a>
                    </div>
                    <div class="category-item">
                        <a href="shop.html?category=electronic-accessories" class="main-category">Electronic Accessories</a>
                    </div>
                    <div class="category-item">
                        <a href="shop.html?category=house" class="main-category">House</a>
                    </div>
                    <div class="category-item">
                        <a href="shop.html?category=land" class="main-category">Land</a>
                    </div>
                </div>
            </div>

            <a href="customerSupport.html" class="nav-item">
                <i class="fas fa-headphones"></i>
                Customer Support
            </a>

            <a href="faqs.html" class="nav-item">
                <i class="fas fa-question-circle"></i>
                Need Help
            </a>

            <div class="contact-info">
                <i class="fas fa-phone"></i>
                <span>+1 202 555 0106</span>
            </div>
        </div>
    </div>
</nav>


    <!-- Breadcrumb Section -->
    <div class="breadcrumb-section">
        <div class="container">
            <div class="breadcrumb">
                <a href="#">
                    <i class="fas fa-home"></i>
                    Home
                </a>
                <span class="breadcrumb-separator">></span>
                <a href="dashboard.html">User Account</a>
                <span class="breadcrumb-separator">></span>
                <a href="#">Dashboard</a>
                <span class="breadcrumb-separator">></span>
                <span class="breadcrumb-current">Settings</span>
            </div>
        </div>
    </div>

    <!-- Settings Main Content -->
    <div class="settings-main">
        <div class="container">
            <div class="settings-wrapper">
                <!-- Settings Sidebar -->
                <div class="settings-sidebar">
                    <div class="settings-menu">
                        <div class="menu-item" onclick="window.location.href='dashboard.html'" style="cursor: pointer;">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Dashboard</span>
                        </div>
                       <div class="menu-item" onclick="window.location.href='wishlist.html'" style="cursor: pointer;">                             
    <i class="fas fa-heart"></i>                             
    <span>Wishlist</span>                         
</div>
                        <div class="menu-item active">
                            <i class="fas fa-cog"></i>
                            <span>Setting</span>
                        </div>
                        <div class="menu-item" onclick="logout()" style="cursor: pointer;">                             
    <i class="fas fa-sign-out-alt"></i>                             
    <span>Log-out</span>                         
</div>

<script>


//login yaptı mı 
/*
if (localStorage.getItem("isLoggedIn") !== "true") {
  window.location.href = "signin.html";
}*/



// kullanıcı verileri getirme & güncelleme
// Settings sayfası için JavaScript kodları - HTML'e eklenecek

// Sayfa yüklendiğinde kullanıcı bilgilerini getir
document.addEventListener('DOMContentLoaded', function() {
    loadUserInfo();

    // Form submit event'lerini bağla
    setupFormSubmissions();
});

// Kullanıcı bilgilerini yükle
function loadUserInfo() {
    fetch('/getUserInfo')
        .then(response => {
            if (!response.ok) {
                throw new Error('User not logged in');
            }
            return response.json();
        })
        .then(user => {
            // Formu kullanıcı bilgileriyle doldur
            document.getElementById('display-name').value = user.firstName || '';
            document.getElementById('display-surname').value = user.lastName || '';
            document.getElementById('email').value = user.email || '';
        })
        .catch(error => {
            console.error('Error loading user info:', error);
            // Kullanıcı giriş yapmamışsa login sayfasına yönlendir
            window.location.href = 'signin.html';
        });
}

// Form submit işlemlerini ayarla
function setupFormSubmissions() {
    // Kullanıcı bilgilerini güncelle
    document.querySelector('.save-changes-btn').addEventListener('click', function(e) {
        e.preventDefault();
        updateUserInfo();
    });

    // Şifre değiştir
    document.querySelector('.change-password-btn').addEventListener('click', function(e) {
        e.preventDefault();
        changePassword();
    });
}

// Kullanıcı bilgilerini güncelle
function updateUserInfo() {
    const firstName = document.getElementById('display-name').value.trim();
    const lastName = document.getElementById('display-surname').value.trim();
    const email = document.getElementById('email').value.trim();

    // Basit doğrulama
    if (!firstName || !lastName || !email) {
        showMessage('Please fill all fields', 'error');
        return;
    }

    if (!isValidEmail(email)) {
        showMessage('Please enter a valid email address', 'error');
        return;
    }

    // Loading göster
    const saveBtn = document.querySelector('.save-changes-btn');
    const originalText = saveBtn.textContent;
    saveBtn.textContent = 'SAVING...';
    saveBtn.disabled = true;

    // FormData oluştur
    const formData = new FormData();
    formData.append('firstName', firstName);
    formData.append('lastName', lastName);
    formData.append('email', email);

    fetch('/dashboard/update-profile', {
        method: 'POST',
        body: formData
    })
    .then(response => {
        // Check if the response is a redirect
        if (response.redirected) {
            // If it's a redirect, follow it
            window.location.href = response.url;
            return;
        }

        // Check if the response is JSON
        const contentType = response.headers.get('content-type');
        if (contentType && contentType.includes('application/json')) {
            return response.json().then(data => {
                if (data.success) {
                    showMessage('User information updated successfully!', 'success');
                } else {
                    showMessage(data.message || 'Failed to update user information', 'error');
                }
            });
        } else {
            // If it's not JSON, show a success message anyway since the server accepted the request
            showMessage('User information updated successfully!', 'success');

            // Reload the page after a short delay to reflect the changes
            setTimeout(() => {
                window.location.reload();
            }, 1500);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showMessage('An error occurred while updating user information', 'error');
    })
    .finally(() => {
        // Loading'i kaldır
        saveBtn.textContent = originalText;
        saveBtn.disabled = false;
    });
}

// Şifre değiştir
function changePassword() {
    const currentPassword = document.getElementById('current-password').value;
    const newPassword = document.getElementById('new-password').value;
    const confirmPassword = document.getElementById('confirm-password').value;

    // Doğrulama
    if (!currentPassword || !newPassword || !confirmPassword) {
        showMessage('Please fill all password fields', 'error');
        return;
    }

    if (newPassword.length < 8) {
        showMessage('New password must be at least 8 characters long', 'error');
        return;
    }

    if (newPassword !== confirmPassword) {
        showMessage('New passwords do not match', 'error');
        return;
    }

    // Loading göster
    const changeBtn = document.querySelector('.change-password-btn');
    const originalText = changeBtn.textContent;
    changeBtn.textContent = 'CHANGING...';
    changeBtn.disabled = true;

    // FormData oluştur
    const formData = new FormData();
    formData.append('currentPassword', currentPassword);
    formData.append('newPassword', newPassword);

    fetch('/dashboard/change-password', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showMessage('Password changed successfully!', 'success');
            // Form alanlarını temizle
            document.getElementById('current-password').value = '';
            document.getElementById('new-password').value = '';
            document.getElementById('confirm-password').value = '';
        } else {
            showMessage(data.message || 'Failed to change password', 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showMessage('An error occurred while changing password', 'error');
    })
    .finally(() => {
        // Loading'i kaldır
        changeBtn.textContent = originalText;
        changeBtn.disabled = false;
    });
}

// Email doğrulama
function isValidEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
}

// Mesaj göster
function showMessage(message, type) {
    // Önceki mesajları kaldır
    const existingMessages = document.querySelectorAll('.message-alert');
    existingMessages.forEach(msg => msg.remove());

    // Yeni mesaj oluştur
    const messageDiv = document.createElement('div');
    messageDiv.className = `message-alert message-${type}`;
    messageDiv.textContent = message;

    // Stil ekle
    messageDiv.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        border-radius: 5px;
        color: white;
        font-weight: bold;
        z-index: 1000;
        animation: slideIn 0.3s ease-out;
        max-width: 300px;
        word-wrap: break-word;
    `;

    if (type === 'success') {
        messageDiv.style.backgroundColor = '#28a745';
    } else if (type === 'error') {
        messageDiv.style.backgroundColor = '#dc3545';
    }

    document.body.appendChild(messageDiv);

    // 3 saniye sonra kaldır
    setTimeout(() => {
        messageDiv.style.animation = 'slideOut 0.3s ease-in';
        setTimeout(() => messageDiv.remove(), 300);
    }, 3000);
}

// CSS animasyonları ekle
const style = document.createElement('style');
style.textContent = `
    @keyframes slideIn {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }

    @keyframes slideOut {
        from {
            transform: translateX(0);
            opacity: 1;
        }
        to {
            transform: translateX(100%);
            opacity: 0;
        }
    }

    .form-input:focus {
        outline: none;
        border-color: #007bff;
        box-shadow: 0 0 5px rgba(0, 123, 255, 0.3);
    }

    .save-changes-btn:disabled,
    .change-password-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }
`;
document.head.appendChild(style);





// log out işlemi
function logout() {
    if (confirm('Are sure to logging out ?')) {

localStorage.removeItem("isLoggedIn");
  window.location.href = 'index.html';


    }
}
</script>
                    </div>
                </div>

                <!-- Settings Content -->
                <div class="settings-content">
                    <!-- Account Settings Section -->
                    <div class="account-settings-section">
                        <div class="section-header">
                            <h2>ACCOUNT SETTINGS</h2>
                        </div>

                        <div class="settings-form">
                            <div class="form-group">
                                <label for="display-name">Name</label>
                                <input type="text" id="display-name" name="firstName" value=" " class="form-input">
                            </div>
                             <div class="form-group">
                                <label for="display-surname">Surname</label>
                                <input type="text" id="display-surname" name="lastName" value=" " class="form-input">
                            </div>

                            <div class="form-group">
                                <label for="email">Email</label>
                                <input type="email" id="email" name="email" value=" " class="form-input">
                            </div>

                            <button class="save-changes-btn">SAVE CHANGES</button>
                        </div>
                    </div>

                    <!-- Change Password Section -->
                    <div class="password-section">
                        <div class="section-header">
                            <h2>CHANGE PASSWORD</h2>
                        </div>

                        <div class="password-form">
                            <div class="form-group">
                                <label for="current-password">Current Password</label>
                                <div class="password-input-wrapper">
                                    <input type="password" id="current-password" name="current-password" class="form-input password-input">
                                    <button type="button" class="password-toggle">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="new-password">New Password</label>
                                <div class="password-input-wrapper">
                                    <input type="password" id="new-password" name="new-password" placeholder="At least 8 characters" class="form-input password-input">
                                    <button type="button" class="password-toggle">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="confirm-password">Confirm Password</label>
                                <div class="password-input-wrapper">
                                    <input type="password" id="confirm-password" name="confirm-password" class="form-input password-input">
                                    <button type="button" class="password-toggle">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </div>
<br>
                            <a href="forgotPass.html" class="forgot-password">Forgot Password?</a>

                            <button class="change-password-btn">CHANGE PASSWORD</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-contact">
                    <div class="footer-logo">
                        <div class="logo-circle">
                            <span class="logo-icon">O</span>
                        </div>
                        <span class="logo-text">Ownify</span>
                    </div>

                    <p>Customer Support:</p>
                    <p>(629) 555-0129</p>

                    <p>Address:</p>
                    <p>4517 Washington Ave.</p>
                    <p>Manchester, Kentucky 39495</p>

                    <p>Email:</p>
                    <p>info@ownify.com</p>
                </div>

                <div class="footer-links">
                    <div class="footer-column">
                        <h4>TOP CATEGORY</h4>
                        <ul>
                            <li><a href="#">Car</a></li>
                            <li><a href="#">House</a></li>
                            <li><a href="#">Land</a></li>
                            <li><a href="#">Accessories</a></li>
                            <li><a href="#">Camera</a></li>
                            <li><a href="#">TV Controller</a></li>
                            <li><a href="#">Browse All Products</a></li>
                        </ul>
                    </div>

                    <div class="footer-column">
                        <h4>QUICK LINKS</h4>
                        <ul>
                            <li><a href="shopPage.html">Shop Product</a></li>
                            <li><a href="wishlist.html">Wishlist</a></li>
                            <li><a href="customerSupport.html">Customer Help</a></li>
                            <li><a href="aboutUs.html">About Us</a></li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="footer-bottom">
                <p>Made with eCommerce Template © 2024 Design by Templatesocean</p>
            </div>
        </div>
    </footer>

    <script>
        // Password toggle functionality
        document.querySelectorAll('.password-toggle').forEach(button => {
            button.addEventListener('click', function() {
                const passwordInput = this.previousElementSibling;
                const icon = this.querySelector('i');

                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    icon.classList.remove('fa-eye');
                    icon.classList.add('fa-eye-slash');
                } else {
                    passwordInput.type = 'password';
                    icon.classList.remove('fa-eye-slash');
                    icon.classList.add('fa-eye');
                }
            });
        });

// Arama fonksiyonları
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.querySelector('.search-input');
    const searchBtn = document.querySelector('.search-btn');

    // Arama butonuna tıklayınca
    searchBtn.addEventListener('click', function() {
        performSearch();
    });

    // Enter tuşuna basınca
    searchInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            performSearch();
        }
    });

    // Gerçek zamanlı arama (kullanıcı yazarken)
    searchInput.addEventListener('input', function() {
        // Biraz gecikme ile arama yap (kullanıcı yazmayı bitirsin diye)
        clearTimeout(window.searchTimeout);
        window.searchTimeout = setTimeout(performSearch, 300);
    });

    function performSearch() {
        const searchTerm = searchInput.value.toLowerCase().trim();
        const products = document.querySelectorAll('.product-item');
        let foundCount = 0;

        products.forEach(product => {
            // Ürün başlığı, açıklama, fiyat vb. alanları kontrol et
            const productTitle = product.querySelector('.product-title, .product-name, h3, h4')?.textContent?.toLowerCase() || '';
            const productDescription = product.querySelector('.product-description, .product-desc, p')?.textContent?.toLowerCase() || '';
            const productPrice = product.querySelector('.price, .product-price')?.textContent?.toLowerCase() || '';
            const productCategory = product.getAttribute('data-category') || '';

            // Tüm metin içeriğini birleştir
            const allText = `${productTitle} ${productDescription} ${productPrice} ${productCategory}`.toLowerCase();

            if (searchTerm === '' || allText.includes(searchTerm)) {
                product.style.display = 'block';
                foundCount++;
            } else {
                product.style.display = 'none';
            }
        });

        // Sonuç sayısını göster
        showSearchResults(searchTerm, foundCount);
    }

    function showSearchResults(searchTerm, count) {
        // Varsa önceki sonuç mesajını kaldır
        const existingResult = document.querySelector('.search-result-message');
        if (existingResult) {
            existingResult.remove();
        }

        if (searchTerm !== '') {
            // Sonuç mesajı oluştur
            const resultMessage = document.createElement('div');
            resultMessage.className = 'search-result-message';
            resultMessage.style.cssText = `
                padding: 15px;
                margin: 20px 0;
                background: #f8f9fa;
                border-left: 4px solid #007bff;
                border-radius: 4px;
            `;

            if (count > 0) {
                resultMessage.innerHTML = `
                    <strong>${count}</strong> product${count !== 1 ? 's' : ''} found for "<strong>${searchTerm}</strong>"
                    <button onclick="clearSearch()" style="float: right; background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">Clear</button>
                `;
            } else {
                resultMessage.innerHTML = `
                    No products found for "<strong>${searchTerm}</strong>"
                    <button onclick="clearSearch()" style="float: right; background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">Clear</button>
                `;
            }

            // Ürün listesinin üstüne ekle
            const productContainer = document.querySelector('.products-container, .product-grid, .products-grid, main');
            if (productContainer) {
                productContainer.insertBefore(resultMessage, productContainer.firstChild);
            }
        }
    }

    // Global fonksiyon - Clear butonuna tıklayınca
    window.clearSearch = function() {
        searchInput.value = '';
        performSearch(); // Tüm ürünleri göster
    }
});

// CSS stilleri dinamik olarak ekle
const searchStyles = `
    .search-result-message {
        animation: fadeIn 0.3s ease-in;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .product-item {
        transition: all 0.3s ease;
    }

    .search-input:focus {
        outline: none;
        box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
    }
`;

// Stilleri head'e ekle
const styleSheet = document.createElement('style');
styleSheet.textContent = searchStyles;
document.head.appendChild(styleSheet);


    </script>
</body>
</html>
